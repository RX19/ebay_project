<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carrito de Compras</title>
    <link rel="stylesheet" href="assets/css/diseñocarrito.css">
</head>
<body>
    <div class="contenedor">

        <header>
            <h1>Carrito de Compras</h1>
            <a href="#" class="comentarios">Envíanos tus comentarios</a>
        </header>

        <div class="contenido-principal">
            <div class="productos-carrito">
                <div class="producto">
                    <!-- Imagen eliminada -->
                    <div class="detalles-producto">
                        <h2>MSI Gaming RTX 4080 Super 16G Gaming X Slim 16GB GDDR6X Tarjeta Gráfica GPU</h2>
                        <p>Vendedor: cabreracollects (100% de feedback positivo)</p>
                        <div class="opciones">
                            <a href="#">Pagar solo a este vendedor</a> |
                            <a href="#">Solicitar envío combinado</a>
                        </div>
                        <div class="cantidad">
                            <label for="cantidad1">Cantidad:</label>
                            <input type="number" id="cantidad1" value="1">
                        </div>
                        <p>USPS Priority Mail</p>
                        <p class="precio">$1,049.99 <span class="envio">$19.21 de envío</span></p>
                        <div class="acciones">
                            <a href="#">Guardar para más tarde</a> |
                            <a href="#">Eliminar</a>
                        </div>
                    </div>
                </div>

                <div class="producto">
                    <!-- Imagen eliminada -->
                    <div class="detalles-producto">
                        <h2>PNY Geforce RTX 4080 SUPER 16GB Verto Overclocked Triple Fan DLSS 3</h2>
                        <p>Vendedor: Focus Camera (99.2% de feedback positivo)</p>
                        <div class="opciones">
                            <a href="#">Pagar solo a este vendedor</a> |
                            <a href="#">Solicitar envío combinado</a>
                        </div>
                        <div class="cantidad">
                            <label for="cantidad2">Cantidad:</label>
                            <input type="number" id="cantidad2" value="1">
                        </div>
                        <p>Envío estándar</p>
                        <p class="precio">$999.99 <span class="envio">Envío gratis</span></p>
                        <div class="acciones">
                            <a href="#">Guardar para más tarde</a> |
                            <a href="#">Eliminar</a>
                        </div>
                    </div>
                </div>

                <div class="producto">
                    <!-- Imagen eliminada -->
                    <div class="detalles-producto">
                        <h2>Lenovo Legion Go Handheld 8.8" WQXGA AMD Ryzen Z1 Extreme 16GB 1TB SSD Wi-Fi</h2>
                        <p>Vendedor: BuyRefurbishedUS (97.7% de feedback positivo)</p>
                        <div class="opciones">
                            <a href="#">Pagar solo a este vendedor</a> |
                            <a href="#">Solicitar envío combinado</a>
                        </div>
                        <div class="cantidad">
                            <label for="cantidad3">Cantidad:</label>
                            <input type="number" id="cantidad3" value="1">
                        </div>
                        <p>FedEx 2Day</p>
                        <p class="precio">$609.99 <span class="envio">Envío gratis</span></p>
                        <p class="renovado">Certificado - Renovado</p>
                        <div class="acciones">
                            <a href="#">Guardar para más tarde</a> |
                            <a href="#">Eliminar</a>
                        </div>
                    </div>
                </div>
            </div>

            <aside class="resumen-carrito">
                <div class="resumen">
                    <p>Artículos (3): <span>$2,659.97</span></p>
                    <p>Envío a 33166-5616: <span>$19.21</span></p>
                    <p>Descuentos: <span>-$48.80</span></p>
                    <p class="subtotal">Subtotal: <span>$2,630.38</span></p>
                    <a href="#" class="checkout">Ir a pagar</a>
                    <p class="recompensas">Gana hasta 5X puntos cuando uses tu eBay Mastercard. <a href="#">Ver detalles</a></p>
                </div>
            </aside>
        </div>

        <section class="explorar-articulos-relacionados">
            <h2>Explorar artículos relacionados</h2>
            <div class="articulos-relacionados">
                <!-- Imágenes eliminadas -->
            </div>
        </section>
    </div>
    <footer>
        <p>© eBayProyectoUNAH.</p>
    </footer> 

    <script>
        // Función para agregar un producto al carrito
        function agregarProductoAlCarrito(productoId, cantidad) {
            fetch('http://localhost:3005/api/carrito/agregar', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    productoId: productoId,
                    cantidad: cantidad,
                    carritoId: 1  // Asume que el carritoId es 1, ajústalo según sea necesario
                })
            })
            .then(response => response.json())
            .then(data => {
                console.log(data);
                alert(data.mensaje);  // Muestra el mensaje de éxito en una alerta
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }

        // Función para eliminar un producto del carrito
        function eliminarProductoDelCarrito(productoId) {
            fetch('http://localhost:3005/api/carrito/eliminar', {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    productoId: productoId,
                    carritoId: 1  // Asume que el carritoId es 1, ajústalo según sea necesario
                })
            })
            .then(response => response.json())
            .then(data => {
                console.log(data);
                alert(data.mensaje);  // Muestra el mensaje de éxito en una alerta
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }

        // Función para iniciar el proceso de pago
        function iniciarPago() {
            fetch('http://localhost:3005/api/carrito/pagar', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    carritoId: 1,  // Asume que el carritoId es 1, ajústalo según sea necesario
                    usuarioId: 1,  // Supón que el usuarioId es 1, ajústalo según sea necesario
                    metodoPagoId: 1,  // Supón que el metodoPagoId es 1, ajústalo según sea necesario
                    direccionEnvioId: 1  // Supón que la direccionEnvioId es 1, ajústalo según sea necesario
                })
            })
            .then(response => response.json())
            .then(data => {
                console.log(data);
                alert(data.mensaje);  // Muestra el mensaje de éxito en una alerta
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }

        // Asignar eventos a los elementos del DOM
        document.getElementById('cantidad1').addEventListener('change', function() {
            const cantidad = this.value;
            agregarProductoAlCarrito(1, cantidad);  // Aquí, 1 es el ID del producto
        });

        document.getElementById('cantidad2').addEventListener('change', function() {
            const cantidad = this.value;
            agregarProductoAlCarrito(2, cantidad);  // Aquí, 2 es el ID del producto
        });

        document.getElementById('cantidad3').addEventListener('change', function() {
            const cantidad = this.value;
            agregarProductoAlCarrito(3, cantidad);  // Aquí, 3 es el ID del producto
        });

        document.querySelectorAll('.acciones a:last-child').forEach((button, index) => {
            button.addEventListener('click', function(event) {
                event.preventDefault();
                eliminarProductoDelCarrito(index + 1);  // Asume que el productoId es el índice + 1
            });
        });

        document.querySelector('.checkout').addEventListener('click', function(event) {
            event.preventDefault();
            iniciarPago();
        });
    </script>
</body>
</html>
